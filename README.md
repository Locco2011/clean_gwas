
# clean_gwas



ä¸€å¥—ç”¨äºæ¸…æ´—ã€æ ¼å¼åŒ–å’Œè½¬æ¢å…¨åŸºå› ç»„å…³è”åˆ†æï¼ˆGWASï¼‰æ‘˜è¦ç»Ÿè®¡æ•°æ®çš„ä¸ªäººè„šæœ¬é›†ã€‚

---

## ğŸ“‹ ç›®å½•

- [è¿è¡Œç¯å¢ƒ](#-è¿è¡Œç¯å¢ƒ)
- [å®‰è£…ä¸é…ç½®](#-å®‰è£…ä¸é…ç½®)
- [æ›´æ–°ä»“åº“](#-æ›´æ–°ä»“åº“)
- [æ ‡å‡†åˆ—åè§£é‡Š](#-æ ‡å‡†åˆ—åè§£é‡Š)
- [ç”¨æ³•æŒ‡å—](#-ç”¨æ³•æŒ‡å—)
  - [1. æ¸…æ´—FinnGen R12æ•°æ®](#1-æ¸…æ´—finngen-r12æ•°æ®)
  - [2. é€šç”¨æ ¼å¼åŒ–ä¸æ•°æ®é¢„è§ˆ](#2-é€šç”¨æ ¼å¼åŒ–ä¸æ•°æ®é¢„è§ˆ)
  - [3. åŸºå› ç»„åæ ‡ç³»è½¬æ¢](#3-åŸºå› ç»„åæ ‡ç³»è½¬æ¢)
  - [4. IEU VCFæ ¼å¼è½¬ä¸ºå¸¸è§„GWASæ ¼å¼](#4-ieu-vcfæ ¼å¼è½¬ä¸ºå¸¸è§„gwasæ ¼å¼)
  - [5. è¡¥å……CHRå’ŒBPå’ŒSNPåˆ—](#5-è¡¥å……chrå’Œbpå’Œsnpåˆ—)
  - [6. ldscæ ¼å¼æ–‡ä»¶](#6-ldscæ ¼å¼æ–‡ä»¶)

---

## ğŸ–¥ï¸ è¿è¡Œç¯å¢ƒ

- **æ“ä½œç³»ç»Ÿ**: Linux Ubuntu 20.04.6 LTS
- **Pythonç‰ˆæœ¬**: Python 3.10

---

## ğŸ› ï¸ å®‰è£…ä¸é…ç½®

è¯·æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤å…‹éš†ä»“åº“å¹¶è®¾ç½®Condaç¯å¢ƒå’ŒRåŒ…çš„ç›¸å…³å®‰è£…ã€‚

---

```bash
# 1. å…‹éš†ä»“åº“åˆ°æœ¬åœ°
git clone https://github.com/Locco2011/clean_gwas.git
```

---
```bash
# 2. è¿›å…¥é¡¹ç›®ç›®å½•
cd clean_gwas
```
---
```bash
# 3. æ ¹æ® environment.yml æ–‡ä»¶åˆ›å»ºå¹¶æ¿€æ´» Conda ç¯å¢ƒ
conda env create -f environment.yml
conda activate clean
```
---
```bash
# 4. è¿›å…¥Ræ ¹æ®R_installed_packages.csvå®‰è£…RåŒ…åŠç›¸å…³ç‰ˆæœ¬
install.packages("remotes")
pkgs<- data.table::fread("./R_installed_packages.csv",header = T)
for (i in 1:nrow(pkgs)) {
  remotes::install_version(pkgs$Package[i], version = pkgs$Version[i])
}
```
---

## ğŸ”„ æ›´æ–°ä»“åº“

å¦‚æœé¡¹ç›®æœ‰æ›´æ–°ï¼Œå¯ä»¥è¿›å…¥é¡¹ç›®ç›®å½•å¹¶æ‰§è¡Œä»¥ä¸‹å‘½ä»¤æ¥ä¸è¿œç¨‹ä»“åº“åŒæ­¥ã€‚

```bash
cd clean_gwas
git pull
```

---

## ğŸ“– æ ‡å‡†åˆ—åè§£é‡Š

æœ¬é¡¹ç›®å¤„ç†çš„æ‰€æœ‰GWASæ•°æ®éƒ½å°†ç»Ÿä¸€ä¸ºä»¥ä¸‹æ ‡å‡†åˆ—åæ ¼å¼ã€‚

| åˆ—å  | è§£é‡Š (Description)                               |
| :---- | :----------------------------------------------- |
| `CHR`   | **æŸ“è‰²ä½“ (Chromosome)**ï¼šSNPæ‰€åœ¨çš„æŸ“è‰²ä½“ç¼–å·ã€‚       |
| `BP`    | **ç‰©ç†ä½ç½® (Base Pair Position)**ï¼šSNPåœ¨æŸ“è‰²ä½“ä¸Šçš„ç‰©ç†ä½ç½®åæ ‡ã€‚ |
| `SNP`   | **SNPæ ‡è¯†ç¬¦ (SNP Identifier)**ï¼šé€šå¸¸æ˜¯rsIDï¼Œä¾‹å¦‚ `rs123456`ã€‚   |
| `A1`    | **ç­‰ä½åŸºå› 1 (Allele 1)**ï¼šé€šå¸¸æ˜¯æ•ˆåº”ç­‰ä½åŸºå› ï¼ˆEffect Alleleï¼‰ã€‚ |
| `A2`    | **ç­‰ä½åŸºå› 2 (Allele 2)**ï¼šé€šå¸¸æ˜¯å‚è€ƒç­‰ä½åŸºå› ï¼ˆReference Alleleï¼‰ã€‚ |
| `P`     | **På€¼ (P-value)**ï¼šè¡¡é‡SNPä¸æ€§çŠ¶å…³è”æ˜¾è‘—æ€§çš„ç»Ÿè®¡æŒ‡æ ‡ï¼Œå€¼è¶Šå°å…³è”æ€§è¶Šå¼ºã€‚ |
| `BETA`  | **æ•ˆåº”å€¼ (Effect Size)**ï¼šè¡¨ç¤ºç­‰ä½åŸºå› `A1`æ¯å¢åŠ ä¸€ä¸ªæ‹·è´æ—¶ï¼Œå¯¹æ€§çŠ¶çš„å¹³å‡å½±å“å¤§å°å’Œæ–¹å‘ã€‚ |
| `SE`    | **æ ‡å‡†è¯¯ (Standard Error)**ï¼š`BETA`å€¼çš„æ ‡å‡†è¯¯å·®ï¼Œåæ˜ äº†æ•ˆåº”å€¼ä¼°è®¡çš„ç²¾åº¦ã€‚ |
| `FRQ`   | **é¢‘ç‡ (Frequency)**ï¼šæ•ˆåº”ç­‰ä½åŸºå› ï¼ˆ`A1`ï¼‰åœ¨ç ”ç©¶äººç¾¤ä¸­çš„é¢‘ç‡ã€‚ |
| `N`     | **æ ·æœ¬é‡ (Sample Size)**ï¼šç”¨äºè¯¥SNPå…³è”åˆ†æçš„æ€»æ ·æœ¬æ•°é‡ã€‚ |

---

## ğŸš€ ç”¨æ³•æŒ‡å—

**é‡è¦æç¤ºï¼š** åœ¨è¿è¡Œä»»ä½•è„šæœ¬ä¹‹å‰ï¼Œè¯·å…ˆä¸ºæ‰€æœ‰ `.sh` è„šæœ¬æ–‡ä»¶æ·»åŠ å¯æ‰§è¡Œæƒé™ã€‚

```bash
sudo chmod +x *.sh
```

### 1. æ¸…æ´—FinnGen R12æ•°æ®

> **æ³¨æ„ï¼š** æ‰§è¡Œå‰è¯·ç¡®ä¿å½“å‰å·¥ä½œç›®å½•ä¸‹åªæœ‰éœ€è¦å¤„ç†çš„FinnGenæ•°æ®æ–‡ä»¶ã€‚

#### æ–¹æ¡ˆAï¼šæ ‡å‡†æ¸…æ´— + è¡¥å……æ ·æœ¬é‡

æ­¤è„šæœ¬ä¼šå°†FinnGenæ•°æ®æ¸…æ´—ä¸ºæ ‡å‡†åˆ—åï¼Œå¹¶æ ¹æ®ç›®å½•ä¸‹çš„ `finnGen_R12.xlsx` æ–‡ä»¶é€šè¿‡ `num_cases` + `num_controls` æ¥è®¡ç®—å¹¶å¡«å…… `N` åˆ—ã€‚

```bash
# å°†ä¸‹è½½çš„èŠ¬å…°æ•°æ®å’Œ finnGen_R12.xlsx æ”¾å…¥å½“å‰ç›®å½•
./finn_clean.sh
```

#### æ–¹æ¡ˆBï¼šå¢å¼ºæ¸…æ´— (æ¨è)

æ­¤è„šæœ¬åœ¨æ–¹æ¡ˆAçš„åŸºç¡€ä¸Šï¼Œå¢åŠ äº†æ›´ä¸¥æ ¼çš„è´¨æ§æ­¥éª¤ï¼Œä»¥æé«˜æ•°æ®è´¨é‡ï¼š
- **è¿‡æ»¤På€¼**ï¼šç§»é™¤ä¸åœ¨ `(0, 1]` åŒºé—´å†…çš„æ— æ•ˆPå€¼ã€‚
- **è¿‡æ»¤ç­‰ä½åŸºå› **ï¼šåªä¿ç•™éé“¾æ¨¡ç³Šï¼ˆstrand-unambiguousï¼‰çš„SNPï¼ˆå³æ’é™¤`A/T`å’Œ`G/C`è¿™ç±»æ˜“æ··æ·†çš„SNPï¼‰ã€‚
- **ç¡®ä¿ç­‰ä½åŸºå› ä¸€è‡´æ€§**ã€‚

```bash
# å°†ä¸‹è½½çš„èŠ¬å…°æ•°æ®æ”¾å…¥å½“å‰ç›®å½•
./finn_clean_plus.sh
```

---

### 2. é€šç”¨æ ¼å¼åŒ–ä¸æ•°æ®é¢„è§ˆ

#### æ¸…æ´—å…¶ä»–GWASæ•°æ®ï¼ˆä»…é‡ç½®åˆ—åï¼‰

æ­¤è„šæœ¬ç”¨äºå°†ä»»æ„æ¥æºçš„GWASæ•°æ®æ ¼å¼åŒ–ä¸ºæœ¬é¡¹ç›®çš„æ ‡å‡†åˆ—åã€‚

> **è­¦å‘Šï¼š** ä½¿ç”¨å‰ï¼Œæ‚¨å¿…é¡»**æ‰‹åŠ¨ä¿®æ”¹ `format_sumstats.sh` è„šæœ¬**ï¼Œä½¿å…¶å†…éƒ¨çš„åˆ—åæ˜ å°„å…³ç³»ä¸æ‚¨çš„åŸå§‹æ–‡ä»¶ç›¸åŒ¹é…ã€‚å¦‚æœåŸå§‹æ•°æ®ä¸­æ²¡æœ‰æ ·æœ¬é‡ï¼ˆ`N`ï¼‰åˆ—ï¼Œæ‚¨ä¹Ÿå¯ä»¥åœ¨è„šæœ¬ä¸­ç›´æ¥ä¸ºæ‰€æœ‰è¡Œç¡¬ç¼–ç ä¸€ä¸ªå›ºå®šçš„æ ·æœ¬é‡ã€‚

```bash
# ç¤ºä¾‹ï¼šå¤„ç†åä¸º my_gwas.txt çš„æ–‡ä»¶
./format_sumstats.sh my_gwas.txt
```

#### æŸ¥çœ‹æ•°æ®ç»“æ„

ä½¿ç”¨æ­¤è„šæœ¬å¯ä»¥å¿«é€Ÿé¢„è§ˆä»»ä½•æ•°æ®æ–‡ä»¶çš„å‰å‡ è¡Œï¼Œæ–¹ä¾¿æ‚¨äº†è§£å…¶åˆ—ç»“æ„ï¼Œä»¥ä¾¿æ­£ç¡®ä¿®æ”¹æ ¼å¼åŒ–è„šæœ¬ã€‚

```bash
# ç¤ºä¾‹ï¼šæŸ¥çœ‹ my_gwas.txt çš„æ–‡ä»¶å¤´
./format_sumstats_preview.sh my_gwas.txt
```

---

### 3. åŸºå› ç»„åæ ‡ç³»è½¬æ¢

> **å‰æï¼š** ç”¨äºè½¬æ¢çš„ `*.txt` æ–‡ä»¶å¿…é¡»æ˜¯å·²ç»è¿‡ä¸Šè¿°æ¸…æ´—ã€å…·æœ‰æ ‡å‡†åˆ—åçš„GWASæ•°æ®ã€‚

#### å•æ–‡ä»¶è½¬æ¢

> - **`hg38` è½¬ `hg37`**
  ```bash
  ./38to37.sh your_standard_gwas_file.txt
  ```

> - **`hg37` è½¬ `hg38`**
  ```bash
  ./37to38.sh your_standard_gwas_file.txt
  ```

#### æ‰¹é‡æ–‡ä»¶è½¬æ¢

> - **æ‰¹é‡ `hg38` è½¬ `hg37`**
  ```bash
  # /path/to/your/folder æ˜¯å­˜æ”¾æ‰€æœ‰ .txt æ ¼å¼æ ‡å‡†GWASæ–‡ä»¶çš„æ–‡ä»¶å¤¹è·¯å¾„
  ./38to37cycle.sh /path/to/your/folder
  ```
  
> - **æ‰¹é‡ `hg37` è½¬ `hg38`**
  ```bash
  # /path/to/your/folder æ˜¯å­˜æ”¾æ‰€æœ‰ .txt æ ¼å¼æ ‡å‡†GWASæ–‡ä»¶çš„æ–‡ä»¶å¤¹è·¯å¾„
  ./37to38cycle.sh /path/to/your/folder
  ```

---

### 4. IEU VCFæ ¼å¼è½¬ä¸ºå¸¸è§„GWASæ ¼å¼

æ­¤ `sh` è„šæœ¬ (`vcf2gwas.sh`) ç”¨äºå°†ä» IEU OpenGWAS ç­‰ä¸‹è½½çš„ `*.vcf.gz` æ ¼å¼çš„æ‘˜è¦ç»Ÿè®¡æ•°æ®ï¼Œè½¬æ¢ä¸ºæœ¬é¡¹ç›®æ‰€å®šä¹‰çš„æ ‡å‡†GWASæ ¼å¼ã€‚

> **è¯´æ˜ï¼š** è„šæœ¬ä¼šä»ieuä¸‹è½½çš„VCFæ–‡ä»¶(`https://gwas.mrcieu.ac.uk/`)ï¼Œå¹¶æ•´ç†æˆæ ‡å‡†çš„è¡¨æ ¼å½¢å¼ï¼Œä½†æ˜¯æå…¶æ¶ˆè€—å’ŒæŸè€—å†…å­˜ã€‚

```bash
# è¿è¡Œshè„šæœ¬è¿›è¡Œæ ¼å¼è½¬æ¢
# ä½¿ç”¨å‰è¯·ç¡®ä¿æ‚¨çš„Condaç¯å¢ƒä¸­å·²åŒ…å«RåŠç›¸å…³ä¾èµ–åŒ…
# ç¤ºä¾‹:
# aaa.vcf.gz: è¾“å…¥çš„VCFæ–‡ä»¶è·¯å¾„
# 389395: è¾“å‡ºçš„æ ‡å‡†GWASçš„æ€»æ ·æœ¬

./vcf2gwas.sh xxx.vcf.gz 389394
```
```bash
# å¤šä¸ªvcf.gzæ–‡ä»¶å¤„ç†å¯è¿™æ ·ï¼Œä»¥ç©ºæ ¼åˆ†å¼€ï¼Œåé¢ç´§éšä¸‹ä¸€ä¸ªæ–‡ä»¶åŠæ ·æœ¬
# aaa.vcf.gzçš„æ€»æ ·æœ¬ä¸º389394ï¼›bbb.vcf.gzçš„æ€»æ ·æœ¬ä¸º387483ï¼›ccc.vcf.gzçš„æ€»æ ·æœ¬ä¸º939348

./vcf2gwas.sh aaa.vcf.gz 389394 bbb.vcf.gz 387483 ccc.vcf.gz 939348
```

---

### 5. è¡¥å……chrå’Œbpå’Œsnpåˆ—

### `ANNOVAR`è½¯ä»¶

æ ¹æ®`CHR`ï¼ˆæŸ“è‰²ä½“ï¼‰å’Œ`BP`ï¼ˆç‰©ç†ä½ç½®ï¼‰åˆ—è¡¥å……`SNP`åˆ—ã€‚

æ ¹æ®`SNP`è¿›è¡Œè¡¥å……`CHR`ï¼ˆæŸ“è‰²ä½“ï¼‰å’Œ`BP`ï¼ˆç‰©ç†ä½ç½®ï¼‰åˆ—ã€‚

`ANNOVAR`åœ°å€ï¼š`https://annovar.openbioinformatics.org/en/latest/user-guide/download/`

`ä¸‹è½½`

`hg19_avsnp150.txt.gz`å¯¹åº”`GRCh37ï¼ˆhg19ï¼‰`

`hg38_avsnp150.txt.gz`å¯¹åº”`GRCh38ï¼ˆhg38ï¼‰`

`https://pan.baidu.com/s/1UNwRLTDuRydelENruHb49w?pwd=ge1e`

> å‰æï¼šæå…¶æ¶ˆè€—å†…å­˜ã€‚

```bash
å¾…æ›´æ–°
```

---

### 6. ldscæ ¼å¼æ–‡ä»¶

æ­¤è„šæœ¬ç”¨äºå½¢æˆldscæ ¼å¼æ–‡ä»¶`.sumstats.gz`ï¼Œä»£ç æ¥æº`https://github.com/belowlab/ldsc/tree/2-to-3`ã€‚

> å‰æï¼šåœ¨ldscæ–‡ä»¶å¤¹ä¸‹å…ˆåˆ›å»ºdataæ–‡ä»¶ï¼Œæ”¾å…¥æ¸…æ´—å¥½çš„æ•°æ®ã€‚

> è§†é¢‘ï¼š`https://pan.baidu.com/s/1f_RTylFqMRYLVpjJN8eYzg?pwd=mdu3`

> æ›´æ”¹ï¼š`MUNGE_PY="/home/cgl/ldsc/munge_sumstats.py"`

> æ›´æ”¹ï¼š`SNP_LIST="/home/cgl/ldsc/eur_w_ld_chr/w_hm3.snplist"`

```bash
# ä¸‹è½½æˆ‘çš„githubä¸Šçš„ldsc.zipï¼ˆå·²ç»åœ¨environment.ymlé‡Œé¢é…ç½®äº†æ¸…åé•œåƒï¼Œæé€Ÿå®‰è£…ï¼‰
# unzip ldsc.zip
# conda env create --file environment.yml
# source activate ldsc
# sudo chmod +x format_ldsc.sh
# æ£€æµ‹æ˜¯å¦å®‰è£…æˆåŠŸ./ldsc.py -h
# æ£€æµ‹æ˜¯å¦å®‰è£…æˆåŠŸ./munge_sumstats.py -h
# mkdir data
conda activate ldsc
./format_ldsc.sh
```
